# 项目概览

> 在 DisGraFS 上安装分布式监控系统，实现对计算节点和存储节点之间通信的实时监控
参考项目：伴鱼<https://tech.ipalfish.com/blog/2020/07/21/tidb_monitor/>

DisGraFS 分为5个组成部分：索引服务器、分布式存储集群、分布式计算集群、网页端和客户端。

- 索引服务器：进行分布式存储集群与分布式计算集群的通信、网页端部署的位置，目前也负责构建与维护图数据库；
- 分布式存储集群：基于 Juicefs 的分布式储存系统，管理、存储和调度分布式存储系统中的所有文件；
- 分布式计算集群：基于 Ray 的分布式计算系统，将文本语义识别、图像识别、语音识别以及元数据提取等任务分散给计算集群中的多个单机；
- 网页端：直观显示文件所构成的图，并将用户在图上的操作以友好方式展示。
- 客户端：客户端负责直接接收用户对文件系统的操作，并针对不同的平台对其进行实现。

## Prometheus监控系统

![](pics/Prometheus%20的整体架构以及生态系统组件.jpg)

Prometheus整体运行需要多个组件配合，其中Prometheus Server主要负责数据的存储并且对外提供数据查询支持，Exporter主要负责样本数据的监控收集并向Prometheus提供标准格式的监控样本数据，alertmanager 负责报警机制，Pushgateway 用于暂时存放来不及处理的 Job 中的数据，防止监控数据丢失。
Prometheus 所有采集的监控数据均以指标（metric）的形式保存在内置的时间序列数据库当中（TSDB）。除了存储的时间序列，Prometheus 还可以根据查询请求产生临时的、衍生的时间序列作为返回结果。

## InfluxDB开源时序型数据库

时序数据库的特点包括：写操作频繁，多为时间顺序写入；删除操作一般为区块删除，如选定开始的历史事件并指定后连续的区块；读操作常为升序或降序地顺序读，高并发读操作很常见。

InfluxDB主要特点：

- 无系统环境依赖，部署方便。
- 支持非结构化数据存储（即适用于多种数据形式，一般存储为二进制），灵活强大。
- 内置http支持，可使用http读写
- 提供类SQL查询语句的操作接口，学习成本低，上手快。
- 丰富的权限管理功能，精细到“表”级别。
- 丰富的时效管理功能，自动删除过期数据，自定义删除指标数据。
- 低成本存储，采样时序数据，数据压缩存储。
- 丰富的聚合函数，支持AVG、SUM、MAX、MIN等聚合函数。

## OpenResty基于NGNIX的可伸缩的Web平台

OpenResty中可以使用 Lua 脚本语言调动NGNIX支持的各种C以及Lua模块，NGNIX采用的是 master-worker 模型，也就是一个 master 进程管理多个 worker 进程，基本的时间处理都放在 worker 进程中，master 进程负责全局初始化以及对 worker 进行的管理。
OpenResty可以快速构造出足以胜任 10K 以上并发连接响应的超高性能 Web 应用系统。

## Grafana可视化度量分析工具（UI）

主要特点：

- 支持多种数据库：Graphite，InfluxDB，OpenTSDB，Prometheus，Elasticsearch，CloudWatch和KairosDB等；
- 展示方式多样全面：面板插件有许多不同方式的可视化指标和日志，官方库中具有丰富的仪表盘插件，比如热图、折线图、图表等多种展示方式；
- 混合展示功能：在同一图表中混合使用不同的数据源，可以基于每个查询指定数据源，甚至自定义数据源；
- 注释：使用来自不同数据源的丰富事件注释图表，将鼠标悬停在事件上会显示完整的事件元数据和标记；
- 通知提醒：以可视方式定义最重要指标的警报规则，Grafana将不断计算并发送通知，在数据达到阈值时通过Slack、PagerDuty等获得通知；
- 过滤器：Ad-hoc过滤器允许动态创建新的键/值过滤器，这些过滤器会自动应用于使用该数据源的所有查询。
